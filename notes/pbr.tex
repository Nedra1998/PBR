\documentclass[10pt]{armath}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{csquotes}
\usepackage{enumitem}
\usepackage{subcaption}
\usepackage{todonotes}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{multicol}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{subfiles}
\usepackage{algpseudocode}
\usepackage{algorithm}
\usepackage{graphics}
\usepackage{longtable}
\usepackage{fontawesome}
\usepackage[toc,page]{appendix}
\usepackage[hidelinks]{hyperref}
\usepackage{minted}
\usepackage[margin=1in]{geometry}
\usetikzlibrary{calc,patterns,angles,quotes,positioning}
\setminted[lua]{
  linenos=true,
  frame=lines,
  framesep=5pt,
  fontsize=\footnotesize
}

\numberwithin{equation}{section}
\newenvironment{Figure}
{\par\medskip\noindent\minipage{\linewidth}}
{\endminipage\par\medskip}

\theoremstyle{definition}
\newtheorem{example}{Example}[section]
\newtheorem{definition}{Definition}[section]

\renewcommand{\thealgorithm}{\arabic{section}.\arabic{algorithm}}
\renewcommand\thefigure{\thesection.\arabic{figure}}

\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\K}{\mathcal{K}}
\newcommand{\ep}{{\varepsilon}}

\newcommand{\pder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\ppder}[2]{\frac{\partial^2 #1}{\partial {#2}^2}}
\newcommand{\px}{{\partial x}}
\newcommand{\ph}{\varphi}
\newcommand{\e}{{(e)}}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wb}[1]{\overline{#1}}
\newcommand{\braket}[2]{\left<{#1},{#2}\right>}
\newcommand{\pluseq}{\mathrel{+}=}
\newcommand{\minuseq}{\mathrel{-}=}
\newcommand{\ra}{\rightarrow}
\newcommand{\lra}{\leftrightarrow}

\newcommand{\hdiv}[3]{
  \vspace{#1}%
  \noindent\rule{\textwidth}{#2}%
  \vspace{#3}%
}
\newcommand{\code}[2]{
  \begin{figure}[thp]\centering\begin{minipage}{0.8\textwidth}\inputminted{#1}{#2}\end{minipage}\end{figure}
}

\title{Physicaly Based Rendering}
\author{Arden Rasmussen}
\date{\today}

\begin{document}
\maketitle

\begin{multicols}{2}
  \section{Radiometry \& Light Attenuation}%
  \label{sec:radiometry_&_light_attenuation}

  \subsection{Radiometry Recap}%
  \label{sub:radiometry_recap}

  \textbf{What to measure in a simulation?}

  \begin{definition}[Radiant flux]
    Total amount of energy passing thought surface (measured per second).
    $\Phi\left[W\right]$.
  \end{definition}

  This is not sufficient to measure, because it is the energy per surface area,
  then consider a large radiant flux that could either be
  \begin{enumerate}
    \item a lot of energy over a small surface.
    \item a little energy over a large surface.
  \end{enumerate}

  Thus this metric is too ambiguous, and not good enough for us.

  \begin{definition}[Irradiance]
    Total amount of energy passing through a unit area. $E\left[W/m^2\right]$.
  \end{definition}

  This is still ambiguous, we haven't fixed the angle which the light arrives to the
  surface. So
  \begin{enumerate}
    \item a lot of energy in a huge angle
    \item a little energy in a small angle
  \end{enumerate}
  will measure the same irradiance.

  \begin{definition}[Radiance]
    Total energy passing through a unit area with unit angle
    $I\left[W/\left(m^2\cdot sr\right)\right]$\footnote{Angle in more dimensions
      is called solid angle, for which the unit is steradians($sr$)}.
  \end{definition}

  This is the measurement that we will be using.

  \subsection{The most fundamental question}%
  \label{sub:the_most_fundamental_question}

  \textbf{How much light exits a surface point in a given direction?}

  The complete answer is given by Maxwell equations! In practice, we don't do
  this, it would require simulations on the size of wavelengths of light, and
  that is overly complex.

  The real solution is the rendering equation!

  \subsection{The scalar product}%
  \label{sub:the_scalar_product}

  \begin{align*}
    \vec{a}\cdot\vec{b}\equiv||\vec{a}||\cdot||\vec{b}||\cos\theta.
  \end{align*}

  For this work we will always assume that the vectors are normalized, and so
  this becomes

  \begin{align*}
    \vec{a}\cdot\vec{b}\equiv\cos\theta.
  \end{align*}

  \subsection{Terminology}%
  \label{sub:terminology}

  The key components in the terminology are depicted in figure
  \ref{fig:02_1}\footnote{Vectors are always pointing away from the point of
    intrest $x$}.

  \begin{Figure}
    \begin{center}
      \input{figures/02_1.tex}
    \end{center}
    \captionof{figure}{Basic terminology}
    \label{fig:02_1}
  \end{Figure}

  \begin{enumerate}
    \item[$\vec{V}$] direction towards the viewer (eye,camera)
    \item[$\vec{N}$] surface normal
    \item[$\vec{L}$] vector point towards the light source
    \item[$\vec{R}$] reflected ray direction
      $\vec{R}=\vec{L}-2\vec{N}\right(\vec{L}\cdot\vec{N}\right)$.
\item[$\theta_i,\theta_r$] incident and reflected angles.
\end{enumerate}

\subsection{Light Attenuation}%
\label{sub:light_attenuation}

When the sun is directly above as in figure \ref{fig:02_1}, then
\begin{align*}
  \left(\vec{L}\cdot\vec{N}\right)\Phi=\cos\alpha|_{\alpha\approx0}\Phi=\Phi.
\end{align*}

\begin{Figure}
  \begin{center}
    \input{figures/02_2}
  \end{center}
  \captionof{figure}{Light attenuation with sun at $45^\circ$.}
  \label{fig:02_2}
\end{Figure}

When the sun is at an angle as in figure \ref{fig:02_2}, then
\begin{align*}
  \left(\vec{L}\cdot\vec{N}\right)\Phi=\cos\alpha|_{\alpha\approx45^\circ}\Phi=0.7\Phi.
\end{align*}

\begin{Figure}
  \begin{center}
    \input{figures/02_3}
  \end{center}
  \captionof{figure}{Light attenuation with sun at $90^\circ$.}
  \label{fig:02_3}
\end{Figure}

When the sun is at an angle as in figure \ref{fig:02_3}, then
\begin{align*}
  \left(\vec{L}\cdot\vec{N}\right)\Phi=\cos\alpha|_{\alpha\approx90^\circ}\Phi=0.
\end{align*}

Thus we can model this light attenuation using this dot product.

\section{BRDF models \& The Rendering Equation}%
\label{sec:brdf_models_&_the_rendering_equation}

\subsection{Materials}%
\label{sub:materials}

\textbf{What makes the difference between materials?}

Different materials reflect incoming light to different directions and absorb
different amounts of it.

\begin{Figure}
  \begin{center}
    \centering
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_1.tex}
        Specular
      \end{center}
    \end{minipage}
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_2.tex}
        Diffuse
      \end{center}
    \end{minipage}
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_3.tex}
        Glossy
      \end{center}
    \end{minipage}
  \end{center}
  \captionof{figure}{Specula, diffuse, and spread reflections from a surface}
  \label{fig:03_1}
\end{Figure}


\begin{description}
  \item[Specular] For one incoming direction there is only one outgoing
    direction, this is what a mirror would be.
  \item[Diffuse] For one incoming direction on there are many possible
    outcomes.
  \item[Glossy/Spread] This is a mixture of specular and diffuse.
\end{description}

\subsection{BRDF}%
\label{sub:brdf}

We will create a probability density function that takes
\begin{enumerate}
  \item an incoming light direction
  \item a point on the surface
\end{enumerate}
as parameters, and outputs the probability of a given outward direction. We
define this function as

\begin{definition}[Bidirectional reflectance distribution function(BRDF)]
  \begin{align*}
    f_r\left(\vec{\omega},x,\vec{\omega}'\right).
  \end{align*}
\end{definition}

What about materials that don't reflect all incoming light, some things that
could transmit the light. There are some examples in figure \ref{fig:03_2}.

\begin{Figure}
  \begin{center}
    \centering
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_4.tex}
        Specular
      \end{center}
    \end{minipage}
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_5.tex}
        Diffuse
      \end{center}
    \end{minipage}
    \begin{minipage}{0.3\textwidth}
      \begin{center}
        \input{figures/03_6.tex}
        Glossy
      \end{center}
    \end{minipage}
  \end{center}
  \captionof{figure}{Transmitted models of light}
  \label{fig:03_2}
\end{Figure}

Things are transparent because atom are mostly empty. Things are opaque,
because the electrons are absobing the photons. The electrons then jump to an
outer orbit. Glass is transparent because the orbits of the electrons are too
far apart, so that if an electron absorbs a photon it does not get enough
energy to jump to the higher orbit. Note that if the light is of a higher
energy (not in the visible spectrum) then it could be opaque. For instance
glass is opaque to UV-light.

\subsection{BTDF}%
\label{sub:btdf}

For light that is also transmited, we have the Bidirectional transmittance
distribution function.

\begin{Figure}
  \begin{center}
    \input{figures/03_7.tex}
  \end{center}
  \captionof{figure}{Light that is both reflected and transmitted}
  \label{fig:03_3}
\end{Figure}

\subsection{BSDF}%
\label{sub:bsdf}

To generalize the BRDF and BTDF, we use the BSDF (S is for scattering).

\subsection{BRDF Properties}%
\label{sub:brdf_properties}

\begin{enumerate}
  \item Helmholtz-reciprocity: The direction of the ray of light can be
    reversed
    \begin{align*}
      \forall\vec{\omega},\vec{\omega}':\quad
      f_r\left(\vec{\omega},x,\vec{\omega}'\right)=f_r\left(\vec{\omega}',x,\vec{\omega}\right)
    \end{align*}
  \item Positivity: It is an impossibility for an exit direction to have a
    negative probability.
    \begin{align*}
      \forall\vec{\omega},\vec{\omega}':\quad
      f_r\left(\vec{\omega},x,\vec{\omega}'\right)\geq 0
    \end{align*}
  \item Energy conservation: An object may reflect or absorb incoming light,
    but no more can com out than the incoming amount.
    \begin{align*}
      \int_\Omega
      f_r\left(\vec{\omega},x,\vec{\omega}'\right)\cos\theta d\vec{\omega}'\leq
      1
    \end{align*}
    This means that we add up all the incoming energy from all possible
    directions, taking the light attenuation into account. If it equals 1, all
    light is is reflected, if it is less than 1 some of the light is absorbed.
    More than 1 is impossible.
\end{enumerate}

\subsection{The Rendering Equation}%
\label{sub:the_rendering_equation}

An object can emit light itself. It also receives light form different
directions, which it will either reflect or absorb, therefore

\begin{Figure}
\begin{center}
\input{figures/03_8.tex}
\end{center}
\captionof{figure}{Rendering Equation Representation}
\label{fig:03_3}
\end{Figure}

\begin{align*}
   L_o\left(x,\vec{\omega}\right)=\underbrace{L_e\left(x,\vec{\omega}\right)}_\text{emitted}+\underbrace{\int_\Omega
   L_i\left(x,\vec{\omega}\right)f_r\left(\vec{\omega},x,\vec{\omega}'\right)\cos\theta
 d\vec{\omega}'}_\text{reflected incoming light}
\end{align*}

Where
\begin{description}
  \item[$L_o\left(x,\vec{\omega}\right)$] exiting radiance in point $x$ towards
    direction $\vec{\omega}$.
  \item[$L_e\left(x,\vec{\omega}\right)$] emitted radiance in point $x$ towards
    direction $\vec{\omega}$.
  \item[$\int_\Omega\cdots d\vec{\omega}'$] Sum of the incoming radiance from
    all $\vec{\omega}'$ directions\footnote{$\Omega$ is only the hemisphere,
      because the $\cos\theta$ from below would be negative, and we don't need
      to deal with this light}.
  \item[$L_i\left(x,\vec{\omega}'\right)$] Incoming radiance from the direction
    $\vec{\omega}'$ to point $x$.
  \item[$f_r\left(\vec{\omega},x,\vec{\omega}'\right)$] BRDF.
  \item[$\cos\theta$] light attenuation.
\end{description}

Difficulties
\begin{enumerate}
  \item The exitant radiance of a point $x$ depends on the incoming radiance of
    every other point, which also depend on $x$. Thus every point depends on
    every other point, and so would be infinitely recursive.
  \item It is absolutely hopeless to compute this integral in closed form.
  \item The integral is also infinite-dimensional. We need to compute an
    infinite number of bounces of light.
  \item It is often singular.
\end{enumerate}

As of now, we have insufficient knowledge to even give an approximate solution
to this equation.

The solution is to compute the entirety of the light path, then move the last
bounce point, and compute the contribution of each individual light source to
the sensor. This is not what we will be using. But here it is
\begin{align*}
   L_o\left(p'\ra p\right)&=L_e\left(p'\ra p\right)\\&+\int_AL_i\left(p^n\ra
       p'\right)f_r\left(p^n\ra p'\ra p\right)\\&\quad\quad\cdot G\left(p^n\lra
       p'\right)dA\left(p^n\right)
\end{align*}
\begin{description}
  \item[$L_o\left(p'\ra p\right)$] outgoing radiance from point $p'$ to $p$.
  \item[$L_e\left(p'\ra p\right)$] emitted radiance from $p'$ to $p$.
  \item[$\int_\Omega\cdots dA\left(p^n\right)'$] sum for all possible $p^n$
    surface points.
  \item[$L_i\left(p^n\ra p'\right)$] incoming radiance form point $p^n$ to
    $p'$.
  \item[$f_r\left(p^n\ra p'\ra p\right)$] probability of $p^n\ra p'\ra p$
    transfer.
  \item[$G\left(p^n\lra p'\right)$] geometry term.
\end{description}

\section{Diffuse, Specular, and Ambient Shading}%
\label{sec:diffuse_specular_and_ambient_shading}

\subsection{BRDF types}%
\label{sub:brdf_types}



\end{multicols}
\end{document}
